{% extends "layouts/sl_base.html" %}
{% load static %}

{% block content %}
<div class="container-fluid py-2">
  <div class="row">
    <div class="col-lg-8 col-md-10 mx-auto">
      <div class="card">
        <div class="card-header pb-0">
          <h5 class="mb-0">Adicionar Membro</h5>
        </div>

        <div class="card-body pt-3">
          <form method="post" novalidate>
            {% csrf_token %}

            <div class="row">
              <div class="col-md-6 mb-3">
                <div class="input-group input-group-outline {% if form_data.first_name %}is-filled{% endif %}">
                  <label class="form-label">Nome *</label>
                  <input type="text" name="first_name" class="form-control"
                         value="{{ form_data.first_name|default_if_none:'' }}">
                </div>
                {% if errors.first_name %}<small class="text-danger">{{ errors.first_name }}</small>{% endif %}
              </div>

              <div class="col-md-6 mb-3">
                <div class="input-group input-group-outline {% if form_data.last_name %}is-filled{% endif %}">
                  <label class="form-label">Apelido *</label>
                  <input type="text" name="last_name" class="form-control"
                         value="{{ form_data.last_name|default_if_none:'' }}">
                </div>
                {% if errors.last_name %}<small class="text-danger">{{ errors.last_name }}</small>{% endif %}
              </div>
            </div>

            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" name="is_company" id="id_is_company"
                     {% if form_data.is_company %}checked{% endif %}>
              <label class="form-check-label" for="id_is_company">É uma empresa?</label>
            </div>

            <div class="mb-3">
              <div class="input-group input-group-outline {% if form_data.legal_name %}is-filled{% endif %}">
                <label class="form-label">Nome Legal</label>
                <input type="text" name="legal_name" class="form-control"
                       value="{{ form_data.legal_name|default_if_none:'' }}">
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <div class="input-group input-group-outline {% if form_data.phone %}is-filled{% endif %}">
                  <label class="form-label">Telefone *</label>
                  <input type="text" name="phone" class="form-control"
                         value="{{ form_data.phone|default_if_none:'' }}">
                </div>
                {% if errors.phone %}<small class="text-danger">{{ errors.phone }}</small>{% endif %}
              </div>

              <div class="col-md-6 mb-3">
                <div class="input-group input-group-outline {% if form_data.alt_phone %}is-filled{% endif %}">
                  <label class="form-label">Telefone alternativo</label>
                  <input type="text" name="alt_phone" class="form-control"
                         value="{{ form_data.alt_phone|default_if_none:'' }}">
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <div class="input-group input-group-outline {% if form_data.email %}is-filled{% endif %}">
                  <label class="form-label">Email</label>
                  <input type="email" name="email" class="form-control"
                         value="{{ form_data.email|default_if_none:'' }}">
                </div>
              </div>

              <div class="col-md-6 mb-3">
                <div class="input-group input-group-outline {% if form_data.city %}is-filled{% endif %}">
                  <label class="form-label">Cidade</label>
                  <input type="text" name="city" class="form-control"
                         value="{{ form_data.city|default_if_none:'' }}">
                </div>
              </div>
            </div>

            <div class="mb-3">
              <div class="input-group input-group-outline {% if form_data.address %}is-filled{% endif %}">
                <label class="form-label">Endereço</label>
                <textarea name="address" class="form-control">{{ form_data.address|default_if_none:'' }}</textarea>
              </div>
            </div>

            <div class="row">
              <div class="col-md-4 mb-3">
                <label class="form-label">Profissão</label>
                <div class="input-group input-group-outline {% if form_data.profession %}is-filled{% endif %}">
                  <input type="text" name="profession" class="form-control"
                         value="{{ form_data.profession|default_if_none:'' }}">
                </div>
              </div>

              <!-- Estado civil – sem floating label -->
              <div class="col-md-4 mb-3">
                <label class="form-label d-block">Estado civil</label>
                <select class="form-select" name="marital_status">
                  <option value="">— Seleccione —</option>
                  <option value="solteiro" {% if form_data.marital_status == "solteiro" %}selected{% endif %}>Solteiro(a)</option>
                  <option value="casado" {% if form_data.marital_status == "casado" %}selected{% endif %}>Casado(a)</option>
                  <option value="divorciado" {% if form_data.marital_status == "divorciado" %}selected{% endif %}>Divorciado(a)</option>
                  <option value="viuvo" {% if form_data.marital_status == "viuvo" %}selected{% endif %}>Viúvo(a)</option>
                </select>
              </div>

              <!-- Sexo – sem floating label -->
              <div class="col-md-4 mb-3">
                <label class="form-label d-block">Sexo</label>
                <select class="form-select" name="gender">
                  <option value="">— Seleccione —</option>
                  <option value="masculino" {% if form_data.gender == "masculino" %}selected{% endif %}>Masculino</option>
                  <option value="feminino" {% if form_data.gender == "feminino" %}selected{% endif %}>Feminino</option>
                  <option value="outro" {% if form_data.gender == "outro" %}selected{% endif %}>Outro</option>
                </select>
              </div>
            </div>

            <!-- Gestor responsável – sem floating label -->
            <div class="mb-3">
              <label class="form-label d-block">Gestor responsável *</label>
              <select name="manager" class="form-select">
                <option value="">— Seleccione —</option>
                {% for g in gestores %}
                  <option value="{{ g.id }}"
                    {% if form_data.manager == g.id|stringformat:"s" %}
                      selected
                    {% endif %}
                  >
                    {{ g.get_full_name|default:g.username }}
                  </option>
                {% endfor %}
              </select>
              {% if errors.manager %}<small class="text-danger">{{ errors.manager }}</small>{% endif %}
            </div>

            <div class="d-flex justify-content-end mt-3">
              <a href="{% url 'core:member_list' %}" class="btn btn-outline-secondary me-2">Cancelar</a>
              <button type="submit" class="btn bg-gradient-dark">Guardar</button>
            </div>

          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const selectors = '.input-group.input-group-outline .form-control, ' +
                      '.input-group.input-group-outline textarea';

    document.querySelectorAll(selectors).forEach(function (el) {
      const wrapper = el.closest('.input-group.input-group-outline');
      if (!wrapper) return;

      if (el.value && el.value.trim() !== '') {
        wrapper.classList.add('is-filled');
      }

      el.addEventListener('focus', function () {
        wrapper.classList.add('is-focused');
      });

      el.addEventListener('blur', function () {
        wrapper.classList.remove('is-focused');
        if (el.value && el.value.trim() !== '') {
          wrapper.classList.add('is-filled');
        } else {
          wrapper.classList.remove('is-filled');
        }
      });
    });
  });
</script>
{% endblock extra_js %}
